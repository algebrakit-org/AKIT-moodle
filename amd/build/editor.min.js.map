{"version":3,"file":"editor.min.js","sources":["../src/editor.js"],"sourcesContent":["/**\n * Javascript entry point for the editor functionality.\n */\n\nimport Selectors from './selectors';\n\n/* eslint-disable no-undef */\nconst AK = AlgebraKIT;\n/* eslint-enable */\n\nexport const init = () => {\n    new AKEditor();\n\n};\n\n\nclass AKEditor {\n    get runButton() {\n        return document.querySelector(Selectors.actions.runButton);\n    }\n    get authoringComponent() {\n      return document.querySelector(Selectors.actions.authoringComponent);\n    }\n    get previewComponent() {\n        return document.querySelector(Selectors.actions.previewComponent);\n    }\n    get previewContainer() {\n        return document.querySelector(Selectors.actions.previewContainer);\n    }\n    get jsonInputElement() {\n        return document.querySelector(Selectors.actions.jsonInputElement);\n    }\n\n    spec = null;\n\n    constructor() {\n        this.runButton.addEventListener('click', this.run.bind(this));\n\n        // get the spec from a hidden input field in the moodle form\n        let jsonString = this.jsonInputElement.value;\n\n        if (jsonString) {\n            this.spec = JSON.parse(jsonString);\n        }\n\n        this.loadEditor();\n    }\n\n    async loadEditor() {\n        await AK.waitUntilReady(this.authoringComponent);\n\n        if (this.spec) {\n          await this.authoringComponent.updateExercise(this.spec);\n        } else {\n          this.spec = await this.authoringComponent.getExercise();\n        }\n\n        this.authoringComponent.addWidgetListener('exerciseChanged', ()=>this.saveSpec());\n      }\n\n      async saveSpec() {\n        if (this.authoringComponent) {\n          // Read the exercise definition from the authoring component\n          this.spec = await this.authoringComponent.getExercise();\n\n          // Update the value of the hidden element\n          this.jsonInputElement.value = JSON.stringify(this.spec);\n        }\n    }\n\n    async run() {\n        this.previewContainer.innerHTML =\n        `<akit-exercise-preview show-run-button=\"false\" exercise-id=\"${this.spec.id}\"></akit-exercise-preview>`;\n\n        await AK.waitUntilReady(this.previewComponent);\n\n        this.previewComponent.run();\n    }\n}\n\n"],"names":["AK","AlgebraKIT","AKEditor","runButton","document","querySelector","Selectors","actions","authoringComponent","previewComponent","previewContainer","jsonInputElement","constructor","addEventListener","this","run","bind","jsonString","value","spec","JSON","parse","loadEditor","waitUntilReady","updateExercise","getExercise","addWidgetListener","saveSpec","stringify","innerHTML","id"],"mappings":"mPAOMA,GAAKC,yBAGS,SACZC,gBAKFA,SACEC,uBACOC,SAASC,cAAcC,mBAAUC,QAAQJ,WAEhDK,gCACKJ,SAASC,cAAcC,mBAAUC,QAAQC,oBAE9CC,8BACOL,SAASC,cAAcC,mBAAUC,QAAQE,kBAEhDC,8BACON,SAASC,cAAcC,mBAAUC,QAAQG,kBAEhDC,8BACOP,SAASC,cAAcC,mBAAUC,QAAQI,kBAKpDC,qKAFO,WAGET,UAAUU,iBAAiB,QAASC,KAAKC,IAAIC,KAAKF,WAGnDG,WAAaH,KAAKH,iBAAiBO,MAEnCD,kBACKE,KAAOC,KAAKC,MAAMJ,kBAGtBK,sCAICtB,GAAGuB,eAAeT,KAAKN,oBAEzBM,KAAKK,WACDL,KAAKN,mBAAmBgB,eAAeV,KAAKK,WAE7CA,WAAaL,KAAKN,mBAAmBiB,mBAGvCjB,mBAAmBkB,kBAAkB,mBAAmB,IAAIZ,KAAKa,8BAIlEb,KAAKN,0BAEFW,WAAaL,KAAKN,mBAAmBiB,mBAGrCd,iBAAiBO,MAAQE,KAAKQ,UAAUd,KAAKK,wBAK/CT,iBAAiBmB,gFACyCf,KAAKK,KAAKW,uCAEnE9B,GAAGuB,eAAeT,KAAKL,uBAExBA,iBAAiBM"}